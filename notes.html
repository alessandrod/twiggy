<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>



<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/">
<title></title>
<style type="text/css">

/*
Author: Peter Parente
Date: 2008/01/22
Version: 1.0
Copyright: This stylesheet has been placed in the public domain - free to edit and use for all uses.
*/

body {
  font: 100% sans-serif;
  background: #ffffff;
  color: black;
  margin: 2em;
  padding: 0em 2em;
}

p.topic-title {
  font-weight: bold;
}

table.docinfo {
  text-align: left;
  margin: 2em 0em;
}

a[href] {
  color: #436976;
  background-color: transparent;
}

a.toc-backref {
  text-decoration: none;
}

h1 a[href] {
  color: #003a6b;
  text-decoration: none;
  background-color: transparent;
}

a.strong {
  font-weight: bold;
}

img {
  margin: 0;
  border: 0;
}

p {
  margin: 0.5em 0 1em 0;
  line-height: 1.5em;
}

p a:visited {
  color: purple;
  background-color: transparent;
}

p a:active {
  color: red;
  background-color: transparent;
}

a:hover {
  text-decoration: none;
}

p img {
  border: 0;
  margin: 0;
}

p.rubric {
  font-weight: bold;
  font-style: italic;
}

h1.title {
  color: #003a6b;
  font-size: 250%;
  margin-bottom: 0em;
}

h2.subtitle {
  color: #003a6b;
  border-bottom: 0px;
}

h1, h2, h3, h4, h5, h6 {
  color: #555;
  background-color: transparent;
  margin: 0em;
  padding-top: 0.5em;
}

h1 {
  font-size: 160%;
  margin-bottom: 0.5em;
  border-bottom: 2px solid #aaa;
}

h2 {
  font-size: 140%;
  margin-bottom: 0.5em;
  border-bottom: 1px solid #aaa;
}

h3 {
  font-size: 130%;
  margin-bottom: 0.5em;
}

h4 {
  font-size: 110%;
  font-weight: bold;
  margin-bottom: 0.5em;
}

h5 {
  font-size: 105%;
  font-weight: bold;
  margin-bottom: 0.5em;
}

h6 {
  font-size: 100%;
  font-weight: bold;
  margin-bottom: 0.5em;
}

dt {
  font-style: italic;
}

dd {
  margin-bottom: 1.5em;
}

div.admonition, div.note, div.tip, div.caution, div.important {
  margin: 2em 2em;
  padding: 0em 1em;
  border-top: 1px solid #aaa;
  border-left: 1px solid #aaa;
  border-bottom: 2px solid #555;
  border-right: 2px solid #555;
}

div.important {
  background: transparent url('../images/important.png') 10px 2px no-repeat;
}

div.caution {
  background: transparent url('../images/caution.png') 10px 2px no-repeat;
}

div.note {
  background: transparent url('../images/note.png') 10px 2px no-repeat;
}

div.tip {
  background: transparent url('../images/tip.png') 10px 2px no-repeat;
}

div.admonition-example {
  background: transparent url('../images/tip.png') 10px 2px no-repeat;
}

div.admonition-critical-example {
  background: transparent url('../images/important.png') 10px 2px no-repeat;
}

p.admonition-title {
  font-weight: bold;
  border-bottom: 1px solid #aaa;
  padding-left: 30px;
}

table.docutils {
  text-align: left;
  border: 1px solid gray;
  border-collapse: collapse;
  width: 100%;
  margin: 1.5em 0em;
}

table.docutils caption {
  font-style: italic;
}

table.docutils td, table.docutils th {
  padding: 0.25em 0.5em;
}

table.docutils th {
  background-color: #dddddd;
}

div.sidebar {
  width: 33%;
  float: right;
  margin: 0em 2em;
  padding: 0em 1em;
  border-top: 1px solid #aaa;
  border-left: 1px solid #aaa;
  border-bottom: 2px solid #555;
  border-right: 2px solid #555;
}

p.sidebar-title {
  margin-bottom: 0em;
  color: #003a6b;
  border-bottom: 1px solid #aaa;
  font-weight: bold;
}

p.sidebar-subtitle {
  margin-top: 0em;
  font-style: italic;
  color: #003a6b;
}

</style>
</head><body>
<div class="document">
<div class="section">
<h1><a id="flubberage" name="flubberage">Flubberage:</a></h1>
<ul class="simple">
<li>author Peter Fein</li>
<li>email <a class="reference" href="mailto:pfein@pobox.com">pfein@pobox.com</a></li>
<li>web <a class="reference" href="http://python-twiggy.googlecode.com/">http://python-twiggy.googlecode.com</a></li>
<li>hg <a class="reference" href="https://python-twiggy.googlecode.com/hg/">https://python-twiggy.googlecode.com/hg/</a></li>
</ul>
</div>
<div class="section">
<h1><a id="usage" name="usage">Usage:</a></h1>
<p>Make doctest work:
&gt;&gt;&gt; import sys; sys.stderr = sys.stdout</p>
<div class="section">
<h2><a id="setup-is-simple" name="setup-is-simple">Setup is simple</a></h2>
<p>In your main.py:</p>
<pre class="doctest-block">&gt;&gt;&gt; import twiggy
&gt;&gt;&gt; twiggy.quick_setup()
</pre>
</div>
<div class="section">
<h2><a id="logging-messages" name="logging-messages">Logging Messages</a></h2>
<pre class="doctest-block">&gt;&gt;&gt; from twiggy import *
</pre>
<p>Main interface is the the magic _log_:</p>
<pre class="doctest-block">&gt;&gt;&gt; log
&lt;twiggy.Logger.Logger object at 0x28ab368&gt;
</pre>
<p>It works out of the box, using standard levels:</p>
<pre class="doctest-block">&gt;&gt;&gt; log.debug('You may not care')
DEBUG:You may not care
&gt;&gt;&gt; log.error('OMFG! Pants on fire!')
ERROR:OMFG! Pants on fire!
</pre>
<p>It supports format strings:</p>
<pre class="doctest-block">&gt;&gt;&gt; log.info('I like %s', "bikes")
INFO:I like bikes
</pre>
<p>But prefers new style:</p>
<pre class="doctest-block">&gt;&gt;&gt; log.info('I wear {0} on my {where}', 'pants', where='legs')
INFO:I wear pants on my legs
</pre>
<p>You can name your loggers:</p>
<pre class="doctest-block">&gt;&gt;&gt; mylog = log.name('alfredo')
&gt;&gt;&gt; mylog.debug('hello')
DEBUG:alfredo:hello
</pre>
</div>
<div class="section">
<h2><a id="better-output" name="better-output">Better output</a></h2>
<p>Newlines are suppressed by default; that can be turned off per-message:</p>
<pre class="doctest-block">&gt;&gt;&gt; log.info('user\ninput\nannoys\nus')
INFO:user\ninput\nannoys\nus
</pre>
<pre class="doctest-block">&gt;&gt;&gt; log.options(suppress_newlines=False).info('we\ndeal')
INFO:we
deal
</pre>
<p>Exceptions are prefixed. Can also pass exc_info. Use '\n' as a prefix to fold into a single line:</p>
<pre class="doctest-block">&gt;&gt;&gt; try:
...     1/0
... except:
...     log.trace('error').warning('oh noes') # error is the default &amp; can be omitted
WARNING:oh noes
TRACE Traceback (most recent call last):
TRACE   File "./futz.py", line 35, in &lt;module&gt;
TRACE     1/0
TRACE ZeroDivisionError: integer division or modulo by zero
</pre>
</div>
<div class="section">
<h2><a id="method-chaining" name="method-chaining">Method Chaining</a></h2>
<p>Each logger instance is created on the fly &amp; is independent:</p>
<pre class="doctest-block">&gt;&gt;&gt; mylog
&lt;twiggy.Logger.Logger object at 0x20899f0&gt;
&gt;&gt;&gt; log.name('alfredo')
&lt;twiggy.Logger.Logger object at 0x2089c58&gt;
</pre>
<p>You don't need to store loggers. I like this chained style a lot.</p>
<pre class="doctest-block">&gt;&gt;&gt; log.name('benito').info('hi there')
INFO:benito:hi there
</pre>
<p>It makes structured logging easy:</p>
<pre class="doctest-block">&gt;&gt;&gt; log.fields(paths=42).info('Going for a walk')
INFO:paths=42:Going for a walk
</pre>
<p>Short cut.  Great for runtime statistics gathering</p>
<pre class="doctest-block">&gt;&gt;&gt; log.struct(paths=42, dolphins='thankful')
INFO:dolphins=thankful:paths=42:
</pre>
<p>Partial binding can be useful for webapps:</p>
<pre class="doctest-block">&gt;&gt;&gt; per_request_log = log.fields(request_id='12345')
&gt;&gt;&gt; per_request_log.fields(rows=100, user='frank').info('frobnicating database')
INFO:request_id=12345:rows=100:user=frank:frobnicating database
&gt;&gt;&gt; per_request_log.fields(bytes=5678).info('sending page over tubes')
INFO:bytes=5678:request_id=12345:sending page over tubes
</pre>
<p>Chained style is awesome:</p>
<pre class="doctest-block">&gt;&gt;&gt; log.name('donjuan').fields(pants='sexy').info("hello, {who} want to {what}?", who='ladies', what='dance')
INFO:donjuan:pants=sexy:hello, ladies want to dance?
</pre>
</div>
<div class="section">
<h2><a id="dynamic" name="dynamic">Dynamic!</a></h2>
<p>Any functions in args/fields are called and the value substitued.</p>
<pre class="doctest-block">&gt;&gt;&gt; import os
&gt;&gt;&gt; import threading
</pre>
<p>We'll provide a useful collection of such things:</p>
<pre class="doctest-block">&gt;&gt;&gt; def thread_name():
...     return threading.currentThread().getName()
</pre>
<pre class="doctest-block">&gt;&gt;&gt; log.fields(pid=os.getpid).info("I'm in thread {0}", log.utils.thread_name)
INFO:pid=1076:I'm in thread MainThread
</pre>
<p>If you really want to log a callable, repr() it or wrap it in lambda.</p>
</div>
<div class="section">
<h2><a id="optimizations" name="optimizations">Optimizations</a></h2>
<p>As an optimization, a min_level can be set on loggers:</p>
<pre class="doctest-block">&gt;&gt;&gt; mylog.min_level = twiggy.Levels.INFO
&gt;&gt;&gt; mylog.info("You see this")
INFO:alfredo:You see this
&gt;&gt;&gt; mylog.debug("This is hidden")
</pre>
<p>They also take a filter that operates on format_spec. The use case is efficiently
shutting off specific messages in a library which is doing something stupid:</p>
<pre class="doctest-block">&gt;&gt;&gt; mylog.filter = lambda s: "shenanigans" not in s
&gt;&gt;&gt; mylog.info("Starting silliness")
INFO:alfredo:Starting silliness
&gt;&gt;&gt; for i in xrange(3): # for large values of 3
...     mylog.info("I call shenanigans!")
&gt;&gt;&gt; mylog.info("End silliness")
INFO:alfredo:End silliness
</pre>
</div>
</div>
<div class="section">
<h1><a id="emitters" name="emitters">Emitters</a></h1>
<p>Multiple emitters can be used by adding to twiggy.emitters (a dict).</p>
<p>Filtering, formatting, and outputting should ideally be indepenent
&amp; composable. Not really sure what the right pattern is here - I'm
a little tired of mixins. Batteries include a small formatting
microframework for common output formats.</p>
<dl class="docutils">
<dt>class Emitter(object):</dt>
<dd><p class="first">"""Emits!</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field"><th class="field-name">ivar min_level:</th><td class="field-body">only emit if greater than this</td>
</tr>
<tr class="field"><th class="field-name">type min_level:</th><td class="field-body">Levels.LogLevel</td>
</tr>
</tbody>
</table>
<p>"""</p>
<dl class="last docutils">
<dt>def emit(self, msg):</dt>
<dd><p class="first">"""emit a message.</p>
<p class="last">This is the only external API
"""</p>
</dd>
<dt>def filter(self, msg):</dt>
<dd><p class="first">"""return True if the message should be emitted</p>
<p class="last">I could be &lt;some_regex&gt;.match, perhaps
"""</p>
</dd>
<dt>def format(self, msg):</dt>
<dd><p class="first">"""
:returns: the formatted message, ready for output
:rtype: string</p>
<p class="last">"""</p>
</dd>
<dt>def output(self, msg, s):</dt>
<dd>"""write out the message"""</dd>
</dl>
</dd>
</dl>
</div>
<div class="section">
<h1><a id="questions" name="questions">Questions:</a></h1>
<p>The only required attributes of message atm are level &amp; format_spec (the text).
I've thought about making name mandatory (eh). Going the other way, I've
thought about making level optional (too flexible, and easy enough to
ignore - see log.struct())</p>
<p>Does the method chaining technique make sense? Is it too magic? I &lt;3 it.
You can do as many .fields()/.name()/.etc() in any order, as long as the
.action() is last.</p>
</div>
<div class="section">
<h1><a id="speed" name="speed">Speed</a></h1>
<p>Timing data: In a super-simple smoke test, twiggy was about 40% faster than
logging. Not rigorous.  sloccount says 220 lines.</p>
</div>
<div class="section">
<h1><a id="the-future" name="the-future">The future</a></h1>
<p>Needs tests, proper docstrings, etc. obviously, but most of the long-term work is in emitters.</p>
<p>Sean, we talked about a Couchdb backend- syslog, &amp; some form of
sql* seems reasonable as well. I'd like to support 'asynchronous'
emitting, at some point - queueing the message and moving the write out
of the critical path of user code via multiprocessing/threading. Might
be interesting to have an emitter/configuration that lets you run
unittests on your log output too.</p>
<p>I have some thoughts about HTML output (perhaps served from a child
process &amp; streamed via AJAX?) but that's getting ahead of
ourselves. ;-)</p>
<div class="section">
<h2><a id="log4j" name="log4j">Log4j</a></h2>
<p>I think I can build a decent fascimle of user-side of log4j with this:</p>
<p>from twiggy import log4j
log4j.getLogger('oldstyle')  -&gt; log.name()
&lt;etc&gt;</p>
</div>
<div class="section">
<h2><a id="further-ahead-of-ourself" name="further-ahead-of-ourself">Further Ahead of Ourself</a></h2>
<p>Lumberjack: log <em>parsing</em> should be easier, esp for casual/ad-hoc use. construct log parsers from same formats used for emitters?  snazzy</p>
<p>Any other pet peeves from logging I may have forgotten about?</p>
<p>YOUR IDEA HERE!</p>
</div>
</div>
</div>
</body></html>